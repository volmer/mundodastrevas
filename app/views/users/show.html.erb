<% content_for :page_title, current_user %>
<% content_for :page_description, strip_tags(current_user.bio) %>
<% content_for :page_author, current_user %>
<% content_for :page_type, 'profile' %>
<% content_for :page_image, URI(root_url) + current_user.avatar.url %>
<% content_for :canonical_url, user_url(current_user) %>
<% content_for :page_updated_at, current_user.updated_at %>

<% content_for :layout_top do %>
  <div class="user-profile-top"
    <% if current_user.avatar.file %>
      style="background-image: url(<%= asset_path(current_user.avatar.medium.url) %>)"
    <% end %>
    >
  </div>
<% end %>

<div class="user-profile">
  <div class="row">
    <div class="col-md-4 avatar">
      <%= image_tag current_user.avatar.medium.url, class: 'img-circle img-thumbnail img-fluid' %>
    </div>

    <div class="col-md-8">
      <h1><%= current_user %></h1>

      <div class="clearfix user-profile-actions">
        <div class="pull-left">
          <%= link_to t('.edit'), edit_user_registration_path, class: 'btn btn-primary-outline btn-sm' %>
        </div>
      </div>

      <% if current_user.bio.present? %>
        <blockquote class="blockquote">
          <%= simple_text current_user.bio %>
        </blockquote>
      <% end %>

      <dl>
        <dt><%= User.human_attribute_name('email') %></dt>
        <dd class="email">
          <%= current_user.email %>
          <% if current_user == current_user && current_user.pending_reconfirmation? %>
             <small class="text-warning"><%= t '.unconfirmed_email', email: current_user.unconfirmed_email %></small>
          <% end %>
        </dd>

        <% if current_user.gender.present? %>
          <dt><%= User.human_attribute_name('gender') %></dt>
          <dd><%= t current_user.gender, scope: 'user.gender_options' %></dd>
        <% end %>

        <% if current_user.location.present? %>
          <dt><%= User.human_attribute_name('location') %></dt>
          <dd><%= current_user.location %></dd>
        <% end %>

        <% if current_user.birthday.present? %>
          <dt><%= User.human_attribute_name('birthday') %></dt>
          <dd><%= l current_user.birthday %></dd>
        <% end %>

        <dt><%= t '.member_since' %></dt>
        <dd><%= l current_user.created_at.to_date, format: :long %></dd>
      </dl>
    </div>
  </div>

  <div class="row">
    <div class="col-sm-4">
      <% if current_user.levels.present? %>
        <div class="list-group">
          <% current_user.levels.each do |level| %>
            <% if level.rank.present? %>
              <%= link_to universe_path(level.universe, anchor: 'tab-ranks'), class: 'list-group-item' do %>
                <div class="user-rank clearfix">
                  <%= image_tag level.universe.image.thumb.url, class: 'img-rounded' %>

                  <h6><%= level.rank %></h6>
                  <%= level.rank.description %>
                </div>
              <% end %>
            <% end %>
          <% end %>
        </div>
      <% end %>
    </div>

    <% if @zines.present? %>
      <div class="col-sm-8">
        <h3><%= t '.zines' %></h3>

        <% @zines.limit(4).each_slice(2) do |row| %>
          <div class="row">
            <% row.each do |zine| %>
              <div class="col-md-6">
                <section class="list-group zine-card">
                  <%= link_to '', zine_path(zine), class: 'list-group-item cover',
                    style: "background-image: url('#{ zine.image.url }')" %>

                  <%= link_to zine_path(zine), class: 'list-group-item' do %>
                    <h4 class="list-group-item-heading">
                      <%= zine %>
                    </h4>
                  <% end %>
                </section>
              </div>
            <% end %>
          </div>
        <% end %>

        <%= link_to t('.all_zines'), user_zines_path(current_user) %>
      </div>
    <% end %>
  </div>
</div>
